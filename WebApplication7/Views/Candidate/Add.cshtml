@model WebApplication7.Models.Candidate

@{
    ViewData["Title"] = "Add Candidate";
}

<h1>Add Candidate</h1>

<form asp-action="Add" method="post">
    <div class="form-group">
        <label asp-for="FirstName"></label>
        <input asp-for="FirstName" class="form-control" />
        <span asp-validation-for="FirstName" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="LastName"></label>
        <input asp-for="LastName" class="form-control" />
        <span asp-validation-for="LastName" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="Email"></label>
        <input asp-for="Email" class="form-control" />
        <span asp-validation-for="Email" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="Mobile"></label>
        <input asp-for="Mobile" class="form-control" />
        <span asp-validation-for="Mobile" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="CV">CV Type</label>
        <select asp-for="CV" class="form-control">
            <option value="pdf">PDF</option>
            <option value="word">Word</option>
            <option value="excel">Excel</option>
        </select>
    </div>
    <div class="form-group">
        <label asp-for="CandidateDegrees">Degrees</label>
        <div id="degreesContainer">
            <select id="degreeDropdown" class="form-control degree-dropdown">
                @* <option value="">Select Degree</option> *@
                 @foreach (var degree in ViewBag.DegreeList)
                {
                    <option value="@degree.Name">@degree.Name</option>
                }
            </select>
        </div> 
    @* <div class="form-group">
        <label>Degrees</label>
        <div id="degreesContainer">
           
            <select name="CandidateDegrees" asp-items="ViewBag.DegreeList.Items" class="form-control degree-dropdown">
                <option value="">Select Degree</option>
            </select>
        </div>
        <button type="button" id="addDegreeButton" class="btn btn-secondary">Add Another Degree</button>
    </div> *@


       @*  <button type="button" id="addDegreeButton" class="btn btn-secondary">Add Another Degree</button> *@
    </div>
    <button type="submit" class="btn btn-primary">Add Candidate</button>
</form>
<div>
    <a asp-controller="Candidate" asp-action="Index">Back to overview</a>
</div>


<script>
    $(document).ready(function () {
        var degreeList = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.DegreeList));

        // Populate the dropdown
        var $dropdown = $('#degreeDropdown');
        $.each(degreeList, function (index, degree) {
            $dropdown.append($('<option>', {
                value: degree.DegreeId,
                text: degree.DegreeName
            }));
        });

        // Close the dropdown when an option is selected
        $dropdown.on('change', function () {
            $(this).blur();
        });
    });




    $('#addDegreeButton').click(function () {
        
        var degreeName = $('#newDegreeName').val().trim();
        if (degreeName) {
            $.ajax({
                url: '@Url.Action("Add", "Degrees")',
                type: 'POST',
                data: { degreeName: degreeName },
                success: function (response) {
                    if (response.success) {
                        degrees.push({ Value: response.degreeId, Text: response.degreeName });
                        var newDropdown = $('<select name="Degrees[' + degreeCounter + ']" class="form-control degree-dropdown"><option value="">Select Degree</option></select>');
                        populateDegreesDropdown(newDropdown);
                        $('#degreesContainer').append(newDropdown);
                        degreeCounter++;
                        refreshDropdowns();
                        $('#newDegreeName').val(''); // Clear the input field
                    } else {
                        alert('Failed to add degree.');
                    }
                },
                error: function () {
                    alert('Error while adding degree.');
                }
            });
        } else {
            alert('Please enter a degree name.');
        }
    });

</script>
}